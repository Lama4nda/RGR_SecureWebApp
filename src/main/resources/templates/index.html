<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>–ú–µ–Ω–µ–¥–∂–µ—Ä –í—ñ–¥–ø–æ—á–∏–Ω–∫—É</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; padding: 20px; background-color: #f4f7f6; }
        h1 { text-align: center; color: #333; }
        .container { display: flex; justify-content: space-between; gap: 20px; }
        .column { flex: 1; background: #fff; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 20px; }
        h2 { color: #0056b3; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        form { display: grid; gap: 10px; margin-bottom: 20px; }
        input[type="text"], input[type="number"], select {
            width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px;
        }
        button {
            background-color: #007bff; color: white; padding: 10px; border: none; border-radius: 4px; cursor: pointer;
        }
        button:hover { background-color: #0056b3; }
        
        ul { list-style-type: none; padding: 0; }
        li {
            display: flex; flex-direction: column; 
            padding: 10px 0; border-bottom: 1px solid #f0f0f0;
        }
        .hotel-info { font-weight: bold; margin-bottom: 5px; }
        .actions { display: flex; gap: 10px; align-items: center; margin-top: 5px; flex-wrap: wrap;}
        
        .admin-link { color: #dc3545; text-decoration: none; font-size: 0.9em; }
        .edit-link { color: orange; }
        
        .book-btn {
            background-color: #28a745; color: white; text-decoration: none;
            padding: 5px 10px; border-radius: 4px; font-size: 0.9em;
        }
        .book-btn:hover { background-color: #218838; }
        
        .no-places {
            color: gray; font-size: 0.9em; border: 1px solid gray; padding: 5px; border-radius: 4px; cursor: not-allowed;
        }

        .closed-status {
            color: red; font-weight: bold; font-size: 0.9em; border: 1px solid red; padding: 5px; border-radius: 4px;
        }

        .alert { padding: 10px; margin-bottom: 20px; border-radius: 5px; text-align: center; }
        .alert-success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-danger { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        
        /* –°—Ç–∏–ª—å –¥–ª—è —ñ–∫–æ–Ω–æ–∫ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π */
        .activity-icons span { cursor: help; margin-right: 2px; }
    </style>
</head>
<body>
    <div style="display: flex; justify-content: space-between; align-items: center;">
    <div>
        <span>–í–∏ —É–≤—ñ–π—à–ª–∏ —è–∫: <b sec:authentication="name">User</b></span>
        <a href="/my-bookings" style="margin-left: 15px; font-weight: bold; color: #007bff;">–ú–æ—ó –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</a>
    </div>
    <a href="/logout" style="color: red;">–í–∏–π—Ç–∏</a>
    </div>
    
    <h1>–ú–µ–Ω–µ–¥–∂–µ—Ä –í—ñ–¥–ø–æ—á–∏–Ω–∫—É</h1>

    <div th:if="${successMessage}" class="alert alert-success">
        <span th:text="${successMessage}"></span>
    </div>
    <div th:if="${errorMessage}" class="alert alert-danger">
        <span th:text="${errorMessage}"></span>
    </div>

    <div class="container">

        <div class="column">
            <h2>–ö—Ä–∞—ó–Ω–∏</h2>
            <form th:action="@{/addCountry}" method="post">
                <input type="text" name="countryName" placeholder="–ù–∞–∑–≤–∞ –Ω–æ–≤–æ—ó –∫—Ä–∞—ó–Ω–∏" required>
                <button type="submit">–î–æ–¥–∞—Ç–∏ –ö—Ä–∞—ó–Ω—É</button>
            </form>
            
            <ul>
                <li th:each="country : ${countries}">
                    <div>
                        <span th:text="${country.name}">–ù–∞–∑–≤–∞ –∫—Ä–∞—ó–Ω–∏</span>
                        <span th:unless="${country.isOpen}" style="color: red; font-weight: bold; font-size: 0.8em;">(–ó–ê–ß–ò–ù–ï–ù–û)</span>
                    </div>
                    
                    <div class="actions" sec:authorize="hasAuthority('ADMIN')">
                        <a class="admin-link edit-link" th:href="@{/editCountry/{id}(id=${country.id})}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
                        <a class="admin-link" th:href="@{/deleteCountry/{id}(id=${country.id})}">–í–∏–¥–∞–ª–∏—Ç–∏</a>
                    </div>
                </li>
            </ul>
        </div>

        <div class="column">
            <h2>–ö—É—Ä–æ—Ä—Ç–∏</h2>
            <form th:action="@{/addResort}" method="post">
                <input type="text" name="resortName" placeholder="–ù–∞–∑–≤–∞ –Ω–æ–≤–æ–≥–æ –∫—É—Ä–æ—Ä—Ç—É" required>
                <select name="countryId" required>
                    <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –∫—Ä–∞—ó–Ω—É</option>
                    <option th:each="country : ${countries}"
                            th:value="${country.id}"
                            th:text="${country.name}">–ö—Ä–∞—ó–Ω–∞</option>
                </select>
                <button type="submit">–î–æ–¥–∞—Ç–∏ –ö—É—Ä–æ—Ä—Ç</button>
            </form>
            
            <ul>
                <li th:each="resort : ${resorts}">
                    <div>
                        <span th:text="${resort.name} + ' (' + ${resort.country.name} + ')'"></span>
                        
                        <span class="activity-icons" style="margin-left: 5px;">
                            <span th:if="${resort.hasSki}" title="–õ–∏–∂—ñ/–°–Ω–æ—É–±–æ—Ä–¥">‚õ∑Ô∏è</span>
                            <span th:if="${resort.hasBeach}" title="–ú–æ—Ä–µ/–ü–ª—è–∂">üèñÔ∏è</span>
                            <span th:if="${resort.hasExcursions}" title="–ï–∫—Å–∫—É—Ä—Å—ñ—ó">üèõÔ∏è</span>
                            <span th:if="${resort.hasSanatorium}" title="–°–∞–Ω–∞—Ç–æ—Ä—ñ–π">üßñ‚Äç‚ôÄÔ∏è</span>
                            <span th:if="${resort.hasEntertainment}" title="–†–æ–∑–≤–∞–≥–∏">üéâ</span>
                        </span>
                        
                        <span th:if="${!resort.country.isOpen}" style="color: red; font-size: 0.8em; font-weight: bold;">(–ö—Ä–∞—ó–Ω–∞ –∑–∞–∫—Ä–∏—Ç–∞)</span>
                        <span th:if="${resort.country.isOpen and !resort.isOpen}" style="color: red; font-size: 0.8em; font-weight: bold;">(–ö—É—Ä–æ—Ä—Ç –∑–∞—á–∏–Ω–µ–Ω–æ)</span>
                    </div>

                    <div class="actions" sec:authorize="hasAuthority('ADMIN')">
                        <a class="admin-link edit-link" th:href="@{/editResort/{id}(id=${resort.id})}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
                        <a class="admin-link" th:href="@{/deleteResort/{id}(id=${resort.id})}">–í–∏–¥–∞–ª–∏—Ç–∏</a>
                   </div>
                </li>
            </ul>
        </div>

        <div class="column">
            <h2>–ì–æ—Ç–µ–ª—ñ</h2>
            
            <form th:action="@{/addHotel}" method="post">
                <input type="text" name="hotelName" placeholder="–ù–∞–∑–≤–∞ –≥–æ—Ç–µ–ª—é" required>
                <input type="number" name="stars" placeholder="–ó—ñ—Ä–∫–∏ (1-5)" min="1" max="5" required>
                <input type="number" name="totalRooms" placeholder="–í—Å—å–æ–≥–æ –∫—ñ–º–Ω–∞—Ç" min="1" required>
                
                <select name="resortId" required>
                    <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –∫—É—Ä–æ—Ä—Ç</option>
                    <option th:each="resort : ${resorts}"
                            th:value="${resort.id}"
                            th:text="${resort.name} + ' (' + ${resort.country.name} + ')'">–ö—É—Ä–æ—Ä—Ç</option>
                </select>
                <button type="submit">–î–æ–¥–∞—Ç–∏ –ì–æ—Ç–µ–ª—å</button>
            </form>
            
            <ul>
                <li th:each="hotel : ${hotels}">
                    <div class="hotel-info">
                        <span th:text="${hotel.name}">–ì–æ—Ç–µ–ª—å</span>
                        <span style="color: gold;" th:text="${#strings.repeat('‚òÖ', hotel.stars)}"></span>
                        <br>
                        
                        <small>
                           <span th:text="${hotel.resort.name}"></span>
                           
                           <span class="activity-icons">
                                <span th:if="${hotel.resort.hasSki}" title="–õ–∏–∂—ñ">‚õ∑Ô∏è</span>
                                <span th:if="${hotel.resort.hasBeach}" title="–ú–æ—Ä–µ">üèñÔ∏è</span>
                                <span th:if="${hotel.resort.hasExcursions}" title="–ï–∫—Å–∫—É—Ä—Å—ñ—ó">üèõÔ∏è</span>
                                <span th:if="${hotel.resort.hasSanatorium}" title="–°–∞–Ω–∞—Ç–æ—Ä—ñ–π">üßñ‚Äç‚ôÄÔ∏è</span>
                                <span th:if="${hotel.resort.hasEntertainment}" title="–†–æ–∑–≤–∞–≥–∏">üéâ</span>
                           </span> 
                           | 
                           
                           –í—ñ–ª—å–Ω–∏—Ö –º—ñ—Å—Ü—å: 
                           <b th:style="${freeRoomsMap.get(hotel.id) > 0} ? 'color: green' : 'color: red'"
                              th:text="${freeRoomsMap.get(hotel.id)} + ' / ' + ${hotel.totalRooms}">
                           </b>
                        </small>
                    </div>

                    <div class="actions">
                        <span th:if="${!hotel.resort.isOpen or !hotel.resort.country.isOpen}" 
                              class="closed-status">
                              –ù–ê–ü–†–Ø–ú–û–ö –ó–ê–ö–†–ò–¢–û
                        </span>

                        <span th:if="${hotel.resort.isOpen and hotel.resort.country.isOpen and freeRoomsMap.get(hotel.id) <= 0}" 
                              class="no-places">
                              –ù–µ–º–∞—î –º—ñ—Å—Ü—å
                        </span>

                        <a th:if="${hotel.resort.isOpen and hotel.resort.country.isOpen and freeRoomsMap.get(hotel.id) > 0}" 
                           th:href="@{/book/{id}(id=${hotel.id})}" 
                           class="book-btn">–ó–∞–±—Ä–æ–Ω—é–≤–∞—Ç–∏</a>

                        <a sec:authorize="hasAuthority('ADMIN')" 
                           class="admin-link edit-link" 
                           th:href="@{/editHotel/{id}(id=${hotel.id})}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
           
                        <a sec:authorize="hasAuthority('ADMIN')"
                           class="admin-link"
                           th:href="@{/deleteHotel/{id}(id=${hotel.id})}">–í–∏–¥–∞–ª–∏—Ç–∏</a>
                   </div>
                </li>
            </ul>
        </div>
    </div>

</body>
</html>